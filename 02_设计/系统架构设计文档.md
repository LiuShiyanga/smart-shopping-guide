# 系统架构设计文档

## 1. 总体架构概述

本系统采用前后端分离架构，前端为浏览器插件（Plasmo + Ant Design + Zustand），后端为Python + FastAPI服务。系统支持多平台数据源（京东、淘宝、小红书、抖音等），通过多智能体（Agent）协作实现智能导购、商品搜索、横向比较、推荐等功能。各Agent通过HTTP/REST API进行通信，中央协调器负责调度。

### 架构图（文字描述）
- **前端插件**：嵌入京东等电商页面，负责用户交互、界面展示、基础对话逻辑。
- **后端服务**：承载多智能体模块，负责数据获取、智能处理、业务逻辑。
- **多平台数据源**：京东、淘宝、小红书、抖音等，通过各自API或爬虫获取商品、评价等信息。
- **中央协调器（Orchestrator）**：接收前端请求，分发给各Agent，聚合结果后返回前端。

## 2. 主要模块划分

- **前端插件模块**
  - UI展示与交互（Ant Design）
  - 状态管理（Zustand）
  - 对话输入输出
  - 与后端API通信

- **后端Agent模块**
  - **中央协调器Agent**：统一调度、聚合结果
  - **对话管理Agent**：意图识别、实体抽取、对话状态管理（规则/状态机+Rasa Core）
  - **多平台数据获取Agent**：对接京东、淘宝、小红书、抖音等平台API，获取商品/评价等数据
  - **搜索Agent**：根据用户关键词检索多平台商品
  - **产品知识Agent**：结构化管理商品参数、属性
  - **问答Agent**：基于知识和评价进行产品问答
  - **比较Agent**：多维度横向比较商品
  - **推荐Agent**：基于规则/内容相似度推荐商品
  - // 用户画像Agent暂不实现，后续可扩展

## 3. 数据流与交互流程

1. 用户在京东等页面通过插件发起对话或搜索请求
2. 前端将请求通过HTTP/REST API发送至后端中央协调器
3. 协调器根据请求类型分发给相关Agent（如搜索、比较、推荐等）
4. 各Agent调用多平台数据源API，获取并处理数据
5. 协调器聚合各Agent结果，生成最终回复
6. 前端插件展示结果，支持多轮对话和交互

## 4. 部署方案

- **前端**：Plasmo打包为浏览器插件，支持Chrome/Edge/Firefox等主流浏览器
- **后端**：Python + FastAPI服务，Docker容器化部署，支持本地或云端（如阿里云、腾讯云）
- **多平台数据源**：通过API或爬虫实时获取，部分高频数据可缓存（如Redis）

## 5. MVP范围说明

- 支持京东、淘宝、小红书、抖音等主流平台的商品检索与信息获取
- 实现基础的多平台商品搜索、横向比较、规则/内容相似推荐、产品问答
- 对话流程以规则/状态机为主，复杂多轮对话可用Rasa Core
- 用户会话历史与偏好仅存储于浏览器本地
- 用户画像Agent暂不实现，后续可扩展

---
如需架构图可视化，可后续补充。

## 6. 系统总体架构

### 6.1 架构图
```
+------------------+     +---------------------+
|                  |     |                     |
|  浏览器插件      |<--->|   后端服务(可选)    |
|  (前端)          |     |                     |
|                  |     +----------+----------+
+--------+---------+                |
         |                          |
         v                          v
+------------------+     +---------------------+
|                  |     |                     |
|   MCP接口        |<--->|    数据存储         |
|                  |     |                     |
+------------------+     +---------------------+
```

### 6.2 模块划分
### 6.3 数据流向

## 7. 多智能体架构设计

### 7.1 智能体定义
- **对话管理Agent**：负责意图识别、实体抽取、对话状态跟踪、策略决策、回复生成。集成规则/状态机与Rasa Core。
- **多平台数据获取Agent**：对接京东、淘宝、小红书、抖音等平台API，统一数据抽象，支持商品、评价、促销等信息抓取。
- **搜索Agent**：根据用户关键词检索多平台商品，支持聚合、去重、筛选、排序。
- **产品知识Agent**：管理结构化商品参数、属性、品牌、类目等，支持知识查询与推理。
- **问答Agent**：基于知识库和评价信息，回答产品相关问题，支持FAQ、属性问答、口碑解读。
- **比较Agent**：多维度横向比较商品，支持自定义对比维度、表格输出。
- **推荐Agent**：基于规则、内容相似度、协同过滤等算法，生成个性化/场景化推荐。
- **中央协调器Agent**：统一接收前端请求，分发任务、聚合结果、管理会话。
- // 用户画像Agent暂不实现，后续可扩展

### 7.2 智能体通信与协作机制
- 采用HTTP/REST API为主，支持同步/异步调用。
- 协调器负责任务分发、Agent间数据流转、超时/异常处理。
- 可扩展为消息队列（如RabbitMQ/Kafka）以支持高并发和解耦。

### 7.3 知识库设计
- 商品知识库：结构化存储商品参数、品牌、类目、属性等。
- 评价知识库：聚合多平台用户评价、评分、口碑标签。
- FAQ与规则库：常见问题、对话模板、推荐规则等。
- 支持定期同步、缓存与增量更新。

## 8. 前端架构

### 8.1 组件设计
- 主体组件：对话区、商品卡片、比较表格、推荐列表、问答区、筛选/排序控件、平台切换等。
- 公共组件：按钮、输入框、弹窗、加载动画、通知等。

### 8.2 状态管理
- 使用Zustand集中管理对话上下文、商品数据、用户偏好、界面状态等。
- 支持本地缓存与会话恢复。

### 8.3 页面与路由
- 插件以单页应用（SPA）为主，内部可按功能模块拆分视图。
- 支持多入口（商品页、列表页、全局悬浮窗等）。

## 9. 后端架构

### 9.1 服务结构
- FastAPI主服务，按Agent模块划分子服务或蓝图。
- 支持水平扩展与负载均衡。

### 9.2 API设计
- 详见《API接口设计文档》，所有接口RESTful，统一认证、错误处理、日志。

### 9.3 业务逻辑层
- 各Agent独立实现核心逻辑，协调器负责流程编排。
- 支持插件化、热更新、A/B测试等扩展。

## 10. 数据存储

### 10.1 数据模型
- 商品、评价、用户、会话、推荐、比较等核心实体建模。
- 结构化数据（如商品参数）与半结构化数据（如评价文本）分离存储。

### 10.2 缓存策略
- 高频商品/评价信息短期缓存（如Redis），减少API压力。
- 前端本地缓存用户会话、偏好、历史。
- 支持缓存失效与主动刷新机制。

## 11. 安全设计

### 11.1 认证与授权
- 后端API采用Token或API Key认证，支持OAuth2扩展。
- 前端与后端通信全程HTTPS。

### 11.2 数据安全
- 敏感信息加密存储与传输。
- 严格权限控制，防止越权访问。
- 不在前端存储API密钥、Token等敏感信息。

### 11.3 通信安全
- 防止XSS、CSRF、SQL注入等常见Web攻击。
- 接口限流与异常检测。

## 12. 可扩展性与性能设计
- 模块化、插件化架构，便于功能扩展与维护。
- 支持多平台、Agent横向扩展。
- 关键路径异步处理，提升并发能力。
- 性能监控与自动告警。

## 13. 限制与约束
- 受限于各平台API/反爬策略，部分数据可能获取不全。
- 推荐与问答效果依赖于数据质量与算法能力。
- 插件兼容性受浏览器和页面结构影响。
- 用户画像、深度个性化等高级功能需后续迭代。

## 14. 参考文档
- 《需求规格说明书》
- 《技术选型报告》
- 《API接口设计文档》
- 《数据库设计说明书》
- 《对话流程与逻辑设计》
- 各平台API/开放平台文档
- 相关安全与合规标准 